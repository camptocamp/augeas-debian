Description: debctrl fixes.
 Debctrl: fixed package paragraph keywords, allow variables for version
 numbers in dependency lists, allow DM-Upload-Allowed keyword
Origin: upstream, https://fedorahosted.org/augeas/changeset/ba1d29c24904ffc534dfbc6d5ef5d85e0c32e299/
Bug-Debian: http://bugs.debian.org/650887
Forwarded: not-needed
Reviewed-By: Igor Pashev <pashev.igor@gmail.com>
Last-Update: <2012-04-16>

--- augeas-0.10.0.orig/lenses/debctrl.aug
+++ augeas-0.10.0/lenses/debctrl.aug
@@ -62,7 +62,8 @@ let multi_line_array_entry (k:regexp) (v
 let version_depends =
     [ label "version"
      . [   del / *\( */ " ( " . label "relation" . store /[<>=]+/ ]
-     . [   del_ws_spc . label "number" . store /[a-zA-Z0-9_.-]+/
+     . [   del_ws_spc . label "number"
+           . store ( /[a-zA-Z0-9_.-]+/ | /\$\{[a-zA-Z0-9:]+\}/ )
          . del / *\)/ " )" ]
     ]
 
@@ -92,7 +93,7 @@ let uploaders  =
 
 let simple_src_keyword = "Source" | "Section" | "Priority"
     | "Standards\-Version" | "Homepage" | /Vcs\-Svn/ | /Vcs\-Browser/
-    | "Maintainer"
+    | "Maintainer" | "DM-Upload-Allowed"
 let depend_src_keywords = /Build\-Depends/ | /Build\-Depends\-Indep/
 
 let src_entries = (   simple_entry simple_src_keyword
@@ -101,12 +102,6 @@ let src_entries = (   simple_entry simpl
 
 
 (* package paragraph *)
-
-let simple_bin_keyword = "Package" | "Architecture" |  "Section"
-    | "Priority" | "Essential" | "Homepage"
-
-let simple_bin_entry = simple_entry simple_bin_keyword
-
 let multi_line_entry (k:string) =
      let line = /.*[^ \t\n].*/ in
       [ label k .  del / / " " .  store line . hardeol ] *
@@ -119,7 +114,8 @@ let description
 
 
 (* binary package *)
-let simple_bin_keywords = "Package" | "Architecture"
+let simple_bin_keywords = "Package" | "Architecture" |  "Section"
+    | "Priority" | "Essential" | "Homepage"
 let depend_bin_keywords = "Depends" | "Recommends" | "Suggests"
 
 let bin_entries = ( simple_entry simple_bin_keywords
--- augeas-0.10.0.orig/lenses/tests/test_debctrl.aug
+++ augeas-0.10.0/lenses/tests/test_debctrl.aug
@@ -205,3 +205,160 @@ Description: dummy2
  dummy text 2
 "
 
+(* Test Augeas' own control file *)
+let augeas_control = "Source: augeas
+Priority: optional
+Maintainer: Nicolas ValcÃ¡rcel Scerpella (Canonical) <nicolas.valcarcel@canonical.com>
+Uploaders: Free Ekanayaka <freee@debian.org>, Micah Anderson <micah@debian.org>
+Build-Depends: debhelper (>= 5), autotools-dev, libreadline-dev, chrpath,
+ naturaldocs (>= 1.51-1), texlive-latex-base
+Standards-Version: 3.9.2
+Section: libs
+Homepage: http://augeas.net/
+DM-Upload-Allowed: yes
+
+Package: augeas-tools
+Section: admin
+Architecture: any
+Depends: ${shlibs:Depends}, ${misc:Depends}
+Description: Augeas command line tools
+ Augeas is a configuration editing tool. It parses configuration files in their
+ native formats and transforms them into a tree. Configuration changes are made
+ by manipulating this tree and saving it back into native config files.
+ .
+ This package provides command line tools based on libaugeas0:
+ - augtool, a tool to manage configuration files.
+ - augparse, a testing and debugging tool for augeas lenses.
+
+Package: libaugeas-dev
+Section: libdevel
+Architecture: any
+Depends: libaugeas0 (= ${binary:Version}), ${shlibs:Depends}, ${misc:Depends}
+Description: Development files for writing applications based on libaugeas0
+ Augeas is a configuration editing tool. It parses configuration files in their
+ native formats and transforms them into a tree. Configuration changes are made
+ by manipulating this tree and saving it back into native config files.
+ .
+ This package includes the development files to write programs using the Augeas
+ API.
+"
+test DebCtrl.lns get augeas_control =
+  { "srcpkg"
+    { "Source" = "augeas" }
+    { "Priority" = "optional" }
+    { "Maintainer" = "Nicolas ValcÃ¡rcel Scerpella (Canonical) <nicolas.valcarcel@canonical.com>" }
+    { "Uploaders"
+      { "1" = "Free Ekanayaka <freee@debian.org>" }
+      { "2" = "Micah Anderson <micah@debian.org>" }
+    }
+    { "Build-Depends"
+      { "and"
+        { "or"
+          { "debhelper"
+            { "version"
+              { "relation" = ">=" }
+              { "number" = "5" }
+            }
+          }
+        }
+      }
+      { "and"
+        { "or"
+          { "autotools-dev" }
+        }
+      }
+      { "and"
+        { "or"
+          { "libreadline-dev" }
+        }
+      }
+      { "and"
+        { "or"
+          { "chrpath" }
+        }
+      }
+      { "and"
+        { "or"
+          { "naturaldocs"
+            { "version"
+              { "relation" = ">=" }
+              { "number" = "1.51-1" }
+            }
+          }
+        }
+      }
+      { "and"
+        { "or"
+          { "texlive-latex-base" }
+        }
+      }
+    }
+    { "Standards-Version" = "3.9.2" }
+    { "Section" = "libs" }
+    { "Homepage" = "http://augeas.net/" }
+    { "DM-Upload-Allowed" = "yes" }
+  }
+  { "binpkg"
+    { "Package" = "augeas-tools" }
+    { "Section" = "admin" }
+    { "Architecture" = "any" }
+    { "Depends"
+      { "and"
+        { "or"
+          { "${shlibs:Depends}" }
+        }
+      }
+      { "and"
+        { "or"
+          { "${misc:Depends}" }
+        }
+      }
+    }
+    { "Description"
+      { "summary" = "Augeas command line tools" }
+      { "text" = "Augeas is a configuration editing tool. It parses configuration files in their" }
+      { "text" = "native formats and transforms them into a tree. Configuration changes are made" }
+      { "text" = "by manipulating this tree and saving it back into native config files." }
+      { "text" = "." }
+      { "text" = "This package provides command line tools based on libaugeas0:" }
+      { "text" = "- augtool, a tool to manage configuration files." }
+      { "text" = "- augparse, a testing and debugging tool for augeas lenses." }
+    }
+  }
+  { "binpkg"
+    { "Package" = "libaugeas-dev" }
+    { "Section" = "libdevel" }
+    { "Architecture" = "any" }
+    { "Depends"
+      { "and"
+        { "or"
+          { "libaugeas0"
+            { "version"
+              { "relation" = "=" }
+              { "number" = "${binary:Version}" }
+            }
+          }
+        }
+      }
+      { "and"
+        { "or"
+          { "${shlibs:Depends}" }
+        }
+      }
+      { "and"
+        { "or"
+          { "${misc:Depends}" }
+        }
+      }
+    }
+    { "Description"
+      { "summary" = "Development files for writing applications based on libaugeas0" }
+      { "text" = "Augeas is a configuration editing tool. It parses configuration files in their" }
+      { "text" = "native formats and transforms them into a tree. Configuration changes are made" }
+      { "text" = "by manipulating this tree and saving it back into native config files." }
+      { "text" = "." }
+      { "text" = "This package includes the development files to write programs using the Augeas" }
+      { "text" = "API." }
+    }
+  }
+
